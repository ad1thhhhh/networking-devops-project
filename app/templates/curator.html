{% extends "base.html" %}
{% block content %}

<div class="max-w-6xl mx-auto space-y-12">

<h1 class="text-4xl font-bold text-caramel tracking-wide">
Curator Task Console
</h1>

<!-- Add Task -->
<div class="card p-8 space-y-6">

    <h2 class="text-xl font-semibold text-caramel">
        Create Café Task
    </h2>

    <div class="grid md:grid-cols-3 gap-6">

        <input type="text"
               id="task_name"
               placeholder="e.g. Clean Coffee Machine"
               class="input-coffee">

        <select id="priority"
                class="input-coffee">
            <option value="normal">Normal Priority</option>
            <option value="high">High Priority</option>
        </select>

        <button onclick="addTask()"
                class="btn-coffee">
            Add Task
        </button>

    </div>

</div>

<!-- KPI Section -->
<div class="grid md:grid-cols-3 gap-8">

    <div class="card p-6 text-center">
        <div class="opacity-60">Total Tasks</div>
        <div id="totalTasks"
             class="text-4xl text-caramel font-bold transition-all duration-300">
            0
        </div>
    </div>

    <div class="card p-6 text-center">
        <div class="opacity-60">Completed</div>
        <div id="completedTasks"
             class="text-4xl text-green-400 font-bold transition-all duration-300">
            0
        </div>
    </div>

    <div class="card p-6 text-center">
        <div class="opacity-60">Pending</div>
        <div id="pendingTasks"
             class="text-4xl text-yellow-400 font-bold transition-all duration-300">
            0
        </div>
    </div>

</div>

<!-- Chart -->
<div class="card p-8">
    <canvas id="taskChart"></canvas>
</div>

</div>

<!-- Toast -->
<div id="toast"
     class="fixed bottom-8 right-8 bg-caramel text-espresso px-6 py-3 rounded-xl shadow-xl opacity-0 transition-all duration-300">
Task Added ☕
</div>

<script>

/* Storage */
function getTasks(){
    return JSON.parse(localStorage.getItem("cafeTasks") || "[]");
}

function saveTasks(tasks){
    localStorage.setItem("cafeTasks", JSON.stringify(tasks));
}

/* Toast */
function showToast(){
    const t=document.getElementById("toast");
    t.style.opacity="1";
    t.style.transform="translateY(-10px)";
    setTimeout(()=>{
        t.style.opacity="0";
        t.style.transform="translateY(0)";
    },2000);
}

/* Counter Animation */
function animateNumber(id,end){
    const el=document.getElementById(id);
    const start=parseInt(el.textContent)||0;
    const duration=600;
    const range=end-start;
    const increment=range/30;
    let current=start;
    let step=0;

    const timer=setInterval(()=>{
        current+=increment;
        el.textContent=Math.round(current);
        step++;
        if(step>=30){
            el.textContent=end;
            clearInterval(timer);
        }
    },duration/30);
}

/* Add Task */
function addTask(){

    const name=document.getElementById("task_name").value.trim();
    const priority=document.getElementById("priority").value;

    if(!name) return;

    const tasks=getTasks();

    tasks.push({
        id:Date.now(),
        name:name,
        priority:priority,
        status:"pending"
    });

    saveTasks(tasks);

    document.getElementById("task_name").value="";
    showToast();
    renderDashboard();
}

/* Chart */
let taskChart;

function renderDashboard(){

    const tasks=getTasks();

    const total=tasks.length;
    const completed=tasks.filter(t=>t.status==="completed").length;
    const pending=total-completed;

    animateNumber("totalTasks",total);
    animateNumber("completedTasks",completed);
    animateNumber("pendingTasks",pending);

    if(taskChart) taskChart.destroy();

    taskChart=new Chart(document.getElementById("taskChart"),{
        type:"doughnut",
        data:{
            labels:["Completed","Pending"],
            datasets:[{
                data:[completed,pending],
                backgroundColor:["#22c55e","#facc15"],
                hoverOffset:10
            }]
        },
        options:{
            animation:{
                animateScale:true,
                duration:1000,
                easing:"easeOutQuart"
            },
            plugins:{
                legend:{
                    labels:{color:"#f5e6d3"}
                }
            }
        }
    });
}

/* Live Sync */
window.addEventListener("storage",renderDashboard);
document.addEventListener("DOMContentLoaded",renderDashboard);

</script>

{% endblock %}
