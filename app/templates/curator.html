{% extends "base.html" %}
{% block content %}

<h1 class="text-4xl font-bold mb-8 fade-in">Curator Dashboard</h1>

<div class="grid md:grid-cols-3 gap-6 mb-8">

    <div class="glass p-6 rounded-2xl text-center hover:scale-105 transition duration-300">
        <div class="text-gray-400">Total Tasks</div>
        <div id="totalTasks" class="text-5xl font-extrabold mt-3 tracking-tight"></div>
    </div>

    <div class="glass p-6 rounded-2xl text-center hover:scale-105 transition duration-300">
        <div class="text-gray-400">Completed</div>
        <div id="completedTasks" class="text-5xl font-extrabold mt-3 tracking-tight"></div>
    </div>

    <div class="glass p-6 rounded-2xl text-center hover:scale-105 transition duration-300">
        <div class="text-gray-400">Progress</div>
        <div class="text-5xl font-extrabold mt-3 tracking-tight">
            {{ progress|round(0) }}%
        </div>
    </div>

</div>

<div class="glass p-6 rounded-2xl mb-8">
    <canvas id="progressChart"></canvas>
</div>

<button onclick="openModal()"
class="btn-primary px-6 py-3 rounded-xl font-semibold">
+ Create Task
</button>

<div class="mt-8 space-y-4">
{% for task in tasks %}
    <div class="glass p-4 rounded-xl flex justify-between">
        <span>{{ task.title }}</span>
        <span class="{% if task.completed %}text-green-400{% else %}text-yellow-400{% endif %}">
            {% if task.completed %}Completed{% else %}Pending{% endif %}
        </span>
    </div>
{% endfor %}
</div>

<!-- Modal -->
<div id="taskModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center">
    <div class="glass p-8 rounded-2xl w-96">
        <h2 class="text-xl font-bold mb-4">Create Task</h2>
        <form method="POST">
            <input type="text" name="task" required
                   class="w-full p-3 rounded-lg bg-gray-800 border border-gray-700 mb-4 focus:ring-2 focus:ring-indigo-500 transition">
            <button class="w-full btn-primary py-3 rounded-lg">Create</button>
        </form>
        <button onclick="closeModal()" class="mt-4 text-gray-400 text-sm">Cancel</button>
    </div>
</div>

<script>
function openModal(){ document.getElementById('taskModal').classList.remove('hidden'); }
function closeModal(){ document.getElementById('taskModal').classList.add('hidden'); }

let total = {{ tasks|length }};
let completed = {{ tasks|selectattr("completed")|list|length }};

document.getElementById("totalTasks").innerText = total;
document.getElementById("completedTasks").innerText = completed;

new Chart(document.getElementById('progressChart'), {
    type: 'doughnut',
    data: {
        labels: ['Completed', 'Remaining'],
        datasets: [{
            data: [completed, total - completed],
            backgroundColor: [
                'rgba(34,197,94,0.8)',
                'rgba(99,102,241,0.6)'
            ],
            borderWidth: 0
        }]
    },
    options: {
        cutout: '75%',
        plugins: {
            legend: {
                labels: { color: 'white' }
            }
        }
    }
});
</script>

{% endblock %}
